{
    "table_definition": {
        "name": "va_grant_role_fact_by_",
        "engine": "MyISAM",
        "comment": "Value Analytics grant role facts aggregated by ${AGGREGATION_UNIT}.",
        "columns": [
            {
                "name": "${AGGREGATION_UNIT}_id",
                "type": "int(10) unsigned",
                "nullable": false,
                "comment": "The ID for the time period from modw.${AGGREGATION_UNIT}s."
            },
            {
                "name": "year",
                "type": "smallint(5) unsigned",
                "nullable": false,
                "comment": "The year of the ${AGGREGATION_UNIT}."
            },
            {
                "name": "${AGGREGATION_UNIT}",
                "type": "smallint(5) unsigned",
                "nullable": false,
                "comment": "The {$AGGREGATION_UNIT} of the year."
            },
            {
                "name": "person_id",
                "type": "int(11)",
                "nullable": false,
                "comment": "The ID of a person who had role on a set of grants."
            },
            {
                "name": "grant_agency_id",
                "type": "int(11)",
                "nullable": false,
                "comment": "The ID of the funding agency of a set of grants."
            },
            {
                "name": "grant_type_id",
                "type": "int(11)",
                "nullable": false,
                "comment": "The ID of the type of a set of grants."
            },
            {
                "name": "grant_role_id",
                "type": "int(11)",
                "nullable": false,
                "comment": "The ID of the role a person had on a set of grants."
            },
            {
                "name": "grant_role_organization_id",
                "type": "int(11)",
                "nullable": false,
                "comment": "The ID of the organization a person represented in their role on a set of grants."
            },
            {
                "name": "num_grant_roles",
                "type": "int(11)",
                "nullable": false,
                "comment": "The number of grant roles in a set of grants."
            },
            {
                "name": "num_grant_roles_started",
                "type": "int(11)",
                "nullable": false,
                "comment": "The number of grant roles started during this time period in a set of grants."
            },
            {
                "name": "num_grant_roles_ended",
                "type": "int(11)",
                "nullable": false,
                "comment": "The number of grant roles ended during this time period in a set of grants."
            }
        ],
        "indexes": [
            {
                "name": "index_period_id",
                "columns": [
                    "${AGGREGATION_UNIT}_id"
                ]
            },
            {
                "name": "index_year",
                "columns": [
                    "year"
                ]
            },
            {
                "name": "index_period_value",
                "columns": [
                    "${AGGREGATION_UNIT}"
                ]
            },
            {
                "name": "index_person_id",
                "columns": [
                    "person_id"
                ]
            },
            {
                "name": "index_grant_agency_id",
                "columns": [
                    "grant_agency_id"
                ]
            },
            {
                "name": "index_grant_type_id",
                "columns": [
                    "grant_type_id"
                ]
            },
            {
                "name": "index_grant_role_id",
                "columns": [
                    "grant_role_id"
                ]
            },
            {
                "name": "index_grant_role_organization_id",
                "columns": [
                    "grant_role_organization_id"
                ]
            }
        ]
    },
    "source_query": {
        "query_hint": "SQL_NO_CACHE",
        "records": {
            "${AGGREGATION_UNIT}_id": "${:PERIOD_ID}",
            "year": "${:YEAR_VALUE}",
            "${AGGREGATION_UNIT}": "${:PERIOD_VALUE}",
            "person_id": "gp.person_id",
            "grant_agency_id": "g.agency_id",
            "grant_type_id": "g.grant_type_id",
            "grant_role_id": "gp.grant_role_id",
            "grant_role_organization_id": "gp.organization_id",
            "num_grant_roles": "COUNT(*)",
            "num_grant_roles_started": "SUM(g.start_time_ts BETWEEN ${:PERIOD_START_TS} AND ${:PERIOD_END_TS})",
            "num_grant_roles_ended": "SUM(g.end_time_ts BETWEEN ${:PERIOD_START_TS} AND ${:PERIOD_END_TS})"
        },
        "groupby": [
            "${AGGREGATION_UNIT}_id",
            "year",
            "${AGGREGATION_UNIT}",
            "person_id",
            "grant_agency_id",
            "grant_type_id",
            "grant_role_id",
            "grant_role_organization_id"
        ],
        "joins": [
            {
                "schema": "${SOURCE_SCHEMA}",
                "name": "grants",
                "alias": "g"
            },
            {
                "schema": "${SOURCE_SCHEMA}",
                "name": "grants_people",
                "alias": "gp",
                "on": "g.id = gp.grant_id"
            }
        ],
        "where": [
            "g.start_time_ts <= ${:PERIOD_END_TS}",
            "g.end_time_ts >= ${:PERIOD_START_TS}"
        ]
    }
}
